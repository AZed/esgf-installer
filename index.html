<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>ESGF: INSTALLER</title>
    <!-- the syle sheet link  -->
    <link rel='stylesheet' href='styles.css' type='text/css'>
    <!-- favorite icon - needs to have the http://full_path link  -->
    <link rel="icon" type="image/png" href="images/esgf-favicon.png">
    
    <!-- keywords for search  engines  -->
    <!-- keywords for search  engines  -->
    <meta name="keywords" content="earth systems grid, go-essp, esg, esgf, distributed computing, distributed storage, climate science">
    <meta name="description" content="A distributed database for structured data.">
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'> 
  </head>
  
  <!-- the page code starts here -->    
  <body>
    <div >  <!-- body -->    
<a href="https://github.com/ESGF/esgf-installer"><img style="position:absolute;top:0;right:0;border:0;" width="149" height="149" src="images/forkme.png" alt="Fork me on GitHub"></a>
      <!-- header starts here -->
      <div id="header" style="overflow: hidden">
        <!-- image floats tot the right -->
        <div style='float: right; margin-right: 100px'>
	  <img src='images/logo.jpg' width="70" height="70" >
        </div>

        <div id='logo' style='float: left; margin-right: 20px; margin-left: -10px'> 
          <a href="http://esgf.org/"><img src='images/esgf-logo.png' width="70" height="70" border="0"></a>
        </div>

	<div>  <!-- inside header -->   
	  <div class="title">ESGF</div>
	  <div class="subtitle">Earth System Grid Federation</div>
          <!-- projects top navigation -->  
	  <div class="projects">  <!-- projects -->   
            <a href="http://esgf.org/esgf-installer/"><b>installer</b></a> &middot;
            <a href="http://esgf.org/esgf-node-manager/">node-manager</a> &middot;
	    <a href="http://esgf.org/esg-publisher/">publisher</a> &middot;
	    <a href="http://esgf.org/esgf-idp/">idp</a> &middot;
	    <a href="http://esgf.org/esg-orp/">orp</a> &middot;
	    <a href="http://esgf.org/esgf-security/">security</a> &middot;
	    <a href="http://esgf.org/esg-search/">search</a> &middot; 
	    <a href="http://esgf.org/esgf-drslib/">drslib</a> &middot;
	    <a href="http://esgf.org/esgf-stager/">stager</a> &middot;
	    <a href="http://esgf.org/esgf-fetcher/">fetcher</a> &middot;
	    <a href="http://esgf.org/esgf-toolbox/">toolbox</a> &middot;
	    <a href="http://esgf.org/projects.html">...</a>
          </div> <!-- projects -->    
	  
        </div>  <!-- inside header -->
      </div>  <!-- header -->
      
      <!-- left side navigation bar starts here -->
      <div class="lsidebar">  <!-- lsidebar -->
	<ul>
	  <li>   <a href="http://esgf.org/">esgf</a> </li>
          <li>   <a href="design.html">design</a> </li>
          <li>   <a href="">download</a> </li>
          <li>   <a href="quickstart.html">quickstart</a>  </li>
          <li>   <a href="developer.html">developer&nbsp;info</a> </li>
          <li>   <a href="performance.html">performance</a> </li>
          <li>   <a href="https://github.com/esgf/esgf-installer">repo</a> </li>
          <li>   <a href="http://devel.esgf.org/esgf-installer-site/docs-generated/javadocs/">code docs</a> </li>
          <li>   <a href="http://devel.esgf.org/esgf-installer-site/docs-generated/dep-reports/">dep-report</a> </li>
          <li>   <a href="http://devel.esgf.org/esgf-installer-site/docs-generated/test-reports/">unit tests</a> </li>
          <li>   <a href="http://devel.esgf.org/esgf-installer-site/docs-generated/coverage-reports/">coverage</a> </li>
          <li>   <a href="ci.html">ci</a> </li>
          <li>   <a href="faq.html">faq</a> </li>
          <li>   <a href="http://esgf.org/mailing_list.html">mailing list</a> </li>
          <li>   <a href="https://github.com/esgf/esgf-installer/issues">bugs</a>  </li>
          <li>   <a href="http://github.com/esgf/esgf-installer/wiki">wiki</a>   </li>
	  <li>   <a href="http://esgf.wordpress.com" target="_blank">blog</a> </li>
        </ul>
        
	
      </div>   <!-- lsidebar -->
      
      <!-- main text comes here -->
      <div class='content'>
	
	<!-- make titles to be <h3> tags -->
	<h3>Your Friendly Neighborhood Installer...</h3>
        <ul>
	  <li>How do you get a motley crew of disperate applications
	and tools; installed, configured and integrated such that they
	form the conhesive union that is the ESGF Node?
          <li>How do you save yourself hours and hours of installation
	hell and get everything, "just right"?
          <li>How do you keep everything updated?
	  <li>How do you perform key maintenance tasks without even
	breaking a sweat?
        </ul>
        <p>
          (wait for it.....)
        <p>
	<h3>Answer: The ESGF Installer</h3>
        <i>And, <b>Yes</b>... it's written all in <a href="http://www.gnu.org/software/bash/manual/bashref.html"><b>BASH</b></a> [<a href="http://en.wikipedia.org/wiki/Bash_%28Unix_shell%29"><b>*</b></a>] ;-) Mmmmwwwaaaaahhhh aaaahh aaahhhhhhh.</i>
        <a href="http://rainbow.llnl.gov/dist/esgf-installer/esg-node">see!</a>
        <hr>
        The ESGF Installer is a collection of scripts that together perform the installation, maintenance and lifecycle control of the ESGF Node.<br>
        Installer options as presented by the <i>help</i> option:
        <pre>
% esg-node --help

  EEEEEEEEEEEEEEEEEEEEEE   SSSSSSSSSSSSSSS         GGGGGGGGGGGGGFFFFFFFFFFFFFFFFFFFFFF
  E::::::::::::::::::::E SS:::::::::::::::S     GGG::::::::::::GF::::::::::::::::::::F
  E::::::::::::::::::::ES:::::SSSSSS::::::S   GG:::::::::::::::GF::::::::::::::::::::F
  EE::::::EEEEEEEEE::::ES:::::S     SSSSSSS  G:::::GGGGGGGG::::GFF::::::FFFFFFFFF::::F
    E:::::E       EEEEEES:::::S             G:::::G       GGGGGG  F:::::F       FFFFFF
    E:::::E             S:::::S            G:::::G                F:::::F             
    E::::::EEEEEEEEEE    S::::SSSS         G:::::G                F::::::FFFFFFFFFF   
    E:::::::::::::::E     SS::::::SSSSS    G:::::G    GGGGGGGGGG  F:::::::::::::::F   
    E:::::::::::::::E       SSS::::::::SS  G:::::G    G::::::::G  F:::::::::::::::F   
    E::::::EEEEEEEEEE          SSSSSS::::S G:::::G    GGGGG::::G  F::::::FFFFFFFFFF   
    E:::::E                         S:::::SG:::::G        G::::G  F:::::F             
    E:::::E       EEEEEE            S:::::S G:::::G       G::::G  F:::::F             
  EE::::::EEEEEEEE:::::ESSSSSSS     S:::::S  G:::::GGGGGGGG::::GFF:::::::FF           
  E::::::::::::::::::::ES::::::SSSSSS:::::S   GG:::::::::::::::GF::::::::FF           
  E::::::::::::::::::::ES:::::::::::::::SS      GGG::::::GGG:::GF::::::::FF           
  EEEEEEEEEEEEEEEEEEEEEE SSSSSSSSSSSSSSS           GGGGGG   GGGGFFFFFFFFFFF.org

  usage:
  (as root)
  esg-node ([--&lt;directive&gt;] | [start] | [stop] | [status] | [restart]
      --prefix      - specify the top level directory for this entire installation's "external" tools
                      (default:/usr/local - currently:/usr/local)
     --workdir     - specify the directory used by the installation to download and build esg artifacts for installation
                     (default:~/workbench/esg - currently:/usr/local/src/esgf/workbench/esg)
     --install     - goes through the installation process
                     will automatically start up node services
     --verify      - runs the test code to verify installation
     --write-env   - writes the necessary env vars to file /etc/esg.env
     --version     - indicates the version of this script
     --check       - checks if this script is the most up-to-date posted &lt;u|c|X&gt; (Update|Continue|eXit)
     --clear       - removes the file holding the enironment state of last install
     --test-pub    - performs the publication test directly (same publication called in last step of install)
     --info        - provides a brief explanation of the DataNode
     --upgrade|--update|update - upgrades/updates the node manager
     --force       - will allow execution of installation|update code to be executed beyond the up2date checks.
                     Basically allowing an installation|update as if starting from scratch.

     -------------------------------
     Configuration Type Selection
     -------------------------------
     --type | -t &lt;data &| index &| idp &| compute&gt; - Select type of node:
         "data" node,
         "index" node,
         "idp" (identity provider) node and/or
         "compute" node
         (note: there is no default one must be selected at least initially...
             when in doubt use "data")
     --set-type  &lt;data &| index &| idp &| compute&gt; - Sets the type value to be used at next start up
     --get-type - returns the last stored type code value of the last run node configuration (data=4 +| index=8 +| idp=16)
     (note: (s|g)et-type flags are singular command flags, meaning they are NOT meant to work with other flags on the same command line!)

     -------------------------------
     Federation / Node Relationship Flags:
     -------------------------------
     --set-default-peer &lt;hostname of peer to be default&gt;
     --get-default-peer - tells you this node's currently configured default peer
     --set-peer-group &lt;name of group(s), comma delim, you wish to participate&gt;
     --get-peer-group - tells you this node's currenly configured peer group(s)
     --federation-sanity-check - tells you if your node's configured peer groups intersect with default peer
     --spotcheck - provides basic federation mesh (inter-connectivity) information. (see esgf-spotcheck script directly)

     -------------------------------
     Security Policy...
     -------------------------------
     --policy-check &lt;resource string&gt; - returns the list of policies that are triggered by the provided resource

     -------------------------------
     Index (search) Utils...
     -------------------------------
     --optimize-index [--force] - optimizes search index for "index" nodes (must be called local to index node)
     --crawl - ingest remote catalogs and their descendants into local index for searching.
     --add-replica-shard  &lt;host&gt;[:&lt;port&gt;] - creates a local replica index of the index at the given &lt;host&gt; mapping to local &lt;port&gt;
     --remove-replica-shard &lt;host&gt;[:&lt;port&gt;] - removes the local replica index bound to &lt;port&gt; named by &lt;host&gt;
     --list-shards  - shows list of registered local replica indexes
     --init-shards  - adds all shards listed in the replica shard configuration file
     --check-shards - checks the configuration for local replica indexes
     --time-shards  - cycles through all known index shards providing query times for each
                      [-show-local] will show timing information for locally replicated shards
                      [-timeout &lt;seconds&gt;] will set the connection timeout value (in seconds)
     --update-publisher-resources - update local repository of publication schemas et al.

     -------------------------------
     Publication Endpoint Setting (Index Peer)
     -------------------------------
     --set-index-peer &lt;hostname of the index peer you wish to publish to&gt; Ex: pcmdi9.llnl.gov
     --get-index-peer - tells you where this node is indexing it's data

     -------------------------------
     IDP Endpoint Setting (IDP Peer)
     -------------------------------
     --set-idp-peer | --set-admin-peer [make selection from menu or input information for idp peer you wish to present credentials to]
     --get-idp-peer - tells you where this node is authenticating against.

     -------------------------------
     Globus Tool Management
     -------------------------------
     --no-globus   - will not perform any operations affecting globus tools (for those with existing globus setups)
     --gridftp-config - [ bdm &| end-user ] (defaults to both)
     --myproxy - [gen-self-cert] &lt;dir&gt; | [regen-simpleca] [fetch-certs|gen-self-cert|keep-certs] | [install|update]

     -------------------------------
     Key Management Flags:
     -------------------------------
     --register    - connects to desired node, fetches and stores their certificate to enable ingress SSL connections
     --migrate-tomcat-credentials-to-esgf - moves credentials and supporting security files under /esg/config
     --generate-ssl-key-and-csr - generate new key and cert request files &lt;pub_cert file&gt; &lt;priv_key file&gt; [&lt;dn&gt;]
                                  (The 'dn' value is of the form - Ex:'/O=ESG/OU=ESGF.ORG/CN=pcmdi11.llnl.gov')

                Ex: esg-node --generate-ssl-key-and-csr /usr/local/tomcat/conf/pcmdi11.llnl.gov-esg-node.csr /usr/local/tomcat/conf/hostkey.pem /O=ESGF/OU=ESGF.ORG/CN=pcmdi11.llnl.gov

     --install-ssl-keypair - takes as input private key and public cert files and installs them. [&lt;pub_cert&gt; [&lt;priv_key&gt; [&lt;keystore&gt; &lt;alias&gt; &lt;password&gt;]]]
     --fetch-esgf-certs - fetches and installs all current public esgf certificates (used by app server and by globus)
     --rebuild-truststore - converts globus' (public) ca certificates into a truststore.
     --add-my-cert-to-truststore - adds public cert from keystore to truststore:
                          (secondary flags for this option)
                          --keystore | -ks &lt;keystore file&gt;
                          --keystore-pass | -kpass &lt;keystore password&gt;
                          --alias | -a &lt;keystore alias&gt;
                          --truststore | -ts &lt;truststore file&gt;
                          --truststore-pass | tpass &lt;truststore password&gt;
     --clear-certs - removes the user-level public certificates' directory (used by myproxy)
     --check-certs - checks both SSL private certificate and Globus private cert for expiration
     --set-auto-fetch-certs [true|false] - sets if federation certificates are loaded automatically upon startup

     (deprecated) --install-signed-cert - installs signed host certificate into keystore and truststore &lt;signed PEM file&gt;
     (deprecated) --export-keys-to-globus  - exports keystore certificates to globus host{cert,key}.pem files.

     --dname - specify the certificate distinguished name to be used when creating certificates
               (the DN value is of the form: "CN=node.lab.gov, OU=simpleCA-pcmdi3.llnl.gov, OU=GlobusTest, O=Grid")
     --keystore-password - sets the password to use for the java keystore - default is the node password.
     --keystore-alias - the alias that is associated with the public cert in the keystore
     --keystore-file  - specify what the keystore file should be - default /usr/local/tomcat/tomcat/conf/keystore-tomcat

     (misc. globus related)
     --generate-globus-key-and-csr - generate new key and cert request for globus (no args - filenames are fixed)
     --install-globus-keypair - installs the signed csr file and does appropriate book keeping. &lt;globus_pub_cert&gt;
     --simpleCA-relink - relink orphaned simpleCA configuration symbolic file links.

     -------------------------------
     Database Management
     -------------------------------
     --config-db    - provides database only configuration to support based on note type (see --get-type)
     --backup-db    - creates a backup of node database to file
                      the prefix for all schemas provided is "esgf_" Ex: -s foo will reference schema esgf_foo
                      [-s|--schema] &lt;schema suffix&gt; 
                      [-db|--database] &lt;database name&gt;
     --restore-db   - restores from (nth) backup of database
                      [-n] &lt;the nth backup&gt; (default is n=1 or the last / most recent backup, 1 &lt;= n &lt;= 7)
                      [-s|--schema] &lt;schema suffix&gt; 
                      [-db|--database] &lt;database name&gt;

     -------------------------------
     Trouble Shooting
     -------------------------------
     --verify-thredds-credentials - if there is a thredds/publisher "re-init" issue this will fix it

     -------------------------------
     Other
     -------------------------------
     --shell - invokes the esgf shell (esgf-sh) to provide a command line REPL inteface to the node

     -------------------------------
     Node Life Cycle Flags:
     -------------------------------
     start   - start the node's services
     stop    - stops the node's services
     status  - status on node's services
     restart - restarts the node's services (calls stop then start :-/)
     update  - update's the node's software stack to prescribed versions
     (notice, no "--" flag prefix to make rc friendly also chkconfig-able ;-)

     -------------------------------
     To add this script to the linux boot sequence: (as root)
     &gt; cd /etc/init.d
     &gt; cp /usr/local/bin/esg-node .
     &gt; chkconfig --add esg-node
     &gt; chkconfig --list esg-node
     -------------------------------


     "stop" | "start" | "status" are meant to be run independent of other flags (and put LAST if other flags are used)
     "--install" may be used with "--verify" but neither are not intended for use
     with stop or start or status
     Ex:
     esg-node --install OR
     esg-node --verify OR
     esg-node --install --verify  OR
     esg-node --write-env OR
     esg-node --version OR
     esg-node --clear OR
     esg-node --test-pub OR
     esg-node --info OR
     esg-node --register [hostname of node] ([truststore passwd])
     esg-node --gridftp-config [ bdm &| end-user ]
     esg-node start OR
     esg-node --gridftp-config [ bdm &| end-user ] start OR
     esg-node stop  OR
     esg-node status OR

     NOTE:

     *You must be root or effectively root to run this program,
     *prefixing the command with sudo will not allow the use of
     *needed environment variables!!!! If you must use sudo, do so
     *only to become root proper then source your user's .[bash]rc
     *file so that root has it's envronment set accordingly!  Or you
     *can more simply become root using sudo's "-s" flag.  After a
     *full install there will be a file created (/etc/esg.env) that has
     *the basic environment vars that were used and set during the
     *installation - this should be sourced by users of this
     *application stack.

     --------------
     Typical usage:
     --------------

     Installation : esg-node --install --verify
         (submit csr and get back returned cert)
     Credentials  : esg-node --install-ssl-keypair &lt;pub_cert&gt; &lt;priv_key&gt;
     Test Publish : esg-node --test-pub
     Update Certs : esg-node [--force] --rebuild-truststore
     Life Cycle   : esg-node [start|stop|status|restart|update]

      ___ ___  ___ ___ 
     | __/ __|/ __| __|
     | _|\__ \ (_ | _| 
     |___|___/\___|_|  


    </pre>
        <hr>
        <b>NOTES</b>:<br>
        Environment variables to be aware of:<br>
        <ul>
          <li><b>install_prefix</b> - (default: /usr/local) This is the top level directory
        where <b>all</b> to tools and artifacts are built that comprise the
        application stack.<br>
          <li><b>esg_root_dir</b> - (default: /esg) This is the location for
        all the data needed for, and used by, the application stack.
        </ul>
        (if you choose to change the values above you must <i>explicitly</i> set them
        in the environment in which the esg-node script is called -
        <u>every time</u>!)
        <p/>
        Other Files Of Interest:<br>
        <ul>
          <li><b>/etc/esg.env</b> - stores the environment vars used by the
          application
          <li><b>/esg/esgf-install-manifest</b> - lists the installed components in
          the current, successful install
        </ul>
        
	<hr>
        <sub>(caveat: At the moment the target installation platform are
        *NIX machines... there are only small bits that preclude it
        working for Apple's version of UNIX... for now) </sub>

      </div> <!-- content -->
      
      <br class="clearfloat" />
      <!-- footer section here -->
      <div id="footer"> 
	<div >  
	  <div class="projects"> 
	    <a href="http://www-pcmdi.llnl.gov" target="_other">PCMDI</a> &middot;
	    <a href="http://cmip-pcmdi.llnl.gov/cmip5/" target="_other">CMIP5</a> &middot; 
	    <a href="http://www.llnl.gov" target="_other">LLNL</a> &middot;
            <a href="https://www.llnl.gov/disclaimer.html" target="_other">Privacy &amp; Legal Notice</a> &middot;
            <a  > LLNL-WEB-460643 &nbsp;&nbsp;&nbsp; </a &middot;></div>
	</div>
      </div>    <!-- footer -->      
      
    </div> <!-- body -->    
  </body>
</html>
